<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta http-equiv="Expires" content="0">
<meta http-equiv="Pragma" content="no-cache">
<meta http-equiv="Cache-control" content="no-cache">
<meta http-equiv="Cache" content="no-cache">
<meta name="viewport"
	content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link rel="stylesheet" type="text/css"
	href="bootstrap/4.1.3/css/bootstrap.css" />
<link rel="shortcut icon" href="bootstrap/4.1.3/images/favicon.ico">
<link rel="stylesheet" type="text/css" href="css/style.css" />
<title>Detail</title>

</head>

<body>
	<!-- Tag: 编写该detail.html，实现对图片详情的展示，可以加入点赞按钮，可以加入一首与该图片有关联的场景音乐 :)，
		必须加入评论列表，评论数据要存入数据库，必须是登录用户才能评论，根据此要求编写其他所需的代码 -->


	<main class="main mt-3" id="main">
		<div class="container">
			<div class="row">
				<div class="col-sm">
					<h1>{{imageId}}</h1>
					<p>{{image}}</p>
				</div>

			</div>
		</div>

	<div  class="container">
		<div class="row " v-for="comment in comments">
			<div class="col-md-1">
			</div>
			<div class="col-md-9 alert alert-secondary push-md-3">
				<div class="row">
				
					<div class="col-md-6 push-md-3">
						用户名:{{comment.username}}
					</div>
					
					<div class="col-md-6">
						评论时间:{{comment.timestamp}}
					</div>
				</div>
			<div class="row">
				<div class="col-md-6 push-md-3">
					评论内容:{{comment.comment}}
				</div>
			</div>
			</div>
		
		</div>
		
	
	
	
		<div class="row" style="margin:80px auto;">
			<div class="col-md-3">
				<!---为了让表单居中显示--->
			</div>
			<div class="col-md-6 push-md-3">
				<form method="get" action="detail">
				  <div class="form-group">
				    <label for="exampleFormControlTextarea1" >评论</label>
    				<textarea class="form-control" name="comment" rows="3"></textarea>'
    				<textarea class="form-control" name="id" rows="3" style="display:none">{{imageId}}</textarea>'
				  </div>
				  <div style="text-align:center;">
				  		<button type="submit" class="btn btn-primary" >提交</button>
				  		<button type="text" class="btn btn-primary">清除</button>
				  		<!-- 
				  			<button type="submit" class="btn btn-warning btn-block"
							v-on:click="getComments(imageId)">提交
							...</button>
				  		
				  		 -->
				  		
				  </div>
				  
				  
				  
				</form>
			</div>
			
		
		</div>
	
	</div>



	</main>
	<!-- jQuery first, then Popper.js, then Bootstrap JS -->
	<script src="js/jquery.slim.min.js"></script>
	<script src="js/popper.min.js"></script>
	<script src="bootstrap/4.1.3/js/bootstrap.js"></script>
	<!-- VUE -->
	<script src="js/vue.js"></script>
	<script src="js/vue-resource.min.js"></script>
	<script src="js/utils.js"></script>
	<script>
		var main = new Vue({
			el : '#main',
			data : {
				imageId : undefined,
				image : undefined,
				comment: undefined,
				comments:[]
			},
			methods : {
				postComment : function(imageId) {
					this.$http.post('api/comments?id=' + imageId+"&comment"+
							this.comment).then(function(res) {
						console.log(res.body);
						if (res.body.code == 1000) {
							this.comments.push(this.comment);
							this.comment = {};
						}
					}, function() {
						console.log('POST comment failed.');
					});
				},
				getImageDetail : function(id) {
					this.$http.get('api/images?id=' + id).then(function(res) {
						console.log(res.body);
						if (res.body.code == 1000) {
							this.image = res.body.data;
						}
						
					}, function() {
						console.log('GET image failed.');
					});
				},
				getComments:function(id){
					
					this.$http.get('api/detail?id=' + id).then(function(res){
						console.log(res.body);
						if(res.body.code==1000){
							for(var i=0;i<res.body.data.length;i++){
								this.comments.push(res.body.data[i]);
							}
						}
					},function(){
						console.log("GET comments failed.")						
					});
					this.refresh(id);
					//this.$router.push({path:'detail.html?id=' + id});
				},
				refresh:function(id){
					//this.$http.get('detail?id'+id);
					console.log("书信");
					//this.$router.push('detail?id'+id);
					//location.reload();

				}
			},
			mounted : function() {
				// 获取URL参数中ID的值
				this.imageId = utils.getValueByUrlParams("id");
				console.log(this.imageId);
				//this.comment = utils.getValueByUrlParams("comment");
				this.getImageDetail(this.imageId);
				this.getComments(this.imageId);
			}
		});
		//main.getComments(main.imageId);
		main.imageId = utils.getValueByUrlParams("id");
		console.log(main.imageId);
	</script>
</body>
</html>